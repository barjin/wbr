{
	"meta":{
	   "name": "Regiojet scraper",
	   "desc": "Scraper for the Regiojet online bus ticket reservation system. Shows parameters, pagination and limitations of the autoscraping system."
	},
	"workflow":[
		{
		  "id": "acceptCookies",
		  "where":{
			 "selectors":[
				"button:text-matches(\"(accept|agree|souhlasím|allow|přijmout)\", \"i\")"
			 ]
		  },
		  "what":[
			 {
				"type":"click",
				"args":[
				   "button:text-matches(\"(accept|agree|souhlasím|allow|přijmout)\", \"i\")"
				]
			 }
		  ]
	   },
	   {
		"id": "waitForAsyncLoad",
		"where":{
			"selectors": [
				":text-matches(\"(searching|loading)\",\"i\")"
			]
		},
		"what": [
			{
				"type": "waitForTimeout",
				"args": [
					2000
				]
			}
		]
	   },
	   {
		  "id": "closePopups",
		  "where":{
			"selectors":[
				"[class*=popup] button[class*=close]"
			]
		  },
		  "what":[
			 {
				"type":"click",
				"args": "[class*=popup] button[class*=close]"
			 },
			 {
				 "type": "waitForLoadState"
			 }
		  ]
	   },
	   {
	  "id": "Scrape",
	  "where":{
		"$after": "Search",
		"selectors":[
			":text-matches(\"Další spoje\")"
		]
	  },
	  "what":[
		 {
			 "type": "waitForLoadState"
		 },
		 {
			"type":"scrape",
			"args": ".mb-2.font-normal"
		 },
		 {
			"type":"scrape",
			"args": "p+div"
		 },
		 {
			 "type": "click",
			 "args": ":text-matches(\"Další spoje\")"
		 },
		 {
			 "type": "waitForLoadState"
		 },
		 {
			 "type": "waitForTimeout",
			 "args": 2000
		 }
		]
	   },
	   {
		"id": "Search",
		  "where":{
			 "selectors":[
				"div:text(\"Odkud\")"
			 ]
		  },
		  "what":[
			 {
				"type":"click",
				"args":[
					"input[aria-label=Odkud]"
				]
			 },
			 {
				"type":"type",
				"args":[
					"input:visible",
					{
						"$param":"From"
					}
				]
			 },
			 {
				"type":"keyboard.press",
				"args":[
				   "Tab"
				]
			 },
			 {
				"type":"keyboard.press",
				"args":[
				   "Tab"
				]
			 },
			 {
				"type":"keyboard.press",
				"args":[
				   "Tab"
				]
			 },
			 {
				"type":"keyboard.insertText",
				"args":[
				   {
					  "$param":"To"
				   }
				]
			 },
			 {
				"type":"waitForTimeout",
				"args":[
				   1000
				]
			 },
			 {
				"type":"keyboard.press",
				"args":[
				   "Enter"
				]
			 },
			 {
				"type":"keyboard.press",
				"args":[
				   "Enter"
				]
			 },
			 {
				"type":"waitForTimeout",
				"args":3000
			 }
		  ]
	   },
	   {
		  "id": "base",
		  "where":{
		  },
		  "what":[
			 {
				"type":"goto",
				"args": "https://novy.regiojet.cz/"
			 },
			 {
				"type":"waitForLoadState"
			 },
			 {
				"type":"waitForTimeout",
				"args": 5000
			 }
		  ]
	   }
	]
 }