{
    "meta": {
        "name": "Nehnutelnosti.sk scraper (tech demo)",
        "desc": "Scraper for the nehnutelnosti.sk, Slovak real estate online marketplace."
    },
    "workflow": [
        {
            "id": "closePopups",
            "where": {
                "selectors": [
                    "[title=\"SP Consent Message\"]"
                ]
            },
            "what": [
                {
                    "type": "script",
                    "args": "\t\t\t\tconst frame = page.frameLocator(\"[title='SP Consent Message']\");\t\t\t\tawait frame.locator(\"[title='Prijať všetko']\").click();\t\t\t\t"
                },
                {
                    "type": "waitForLoadState"
                }
            ]
        },
        {
            "id": "scrapeInfoPage",
            "where": {
                "selectors": [
                    ".price--main.paramNo0"
                ]
            },
            "what": [
                {
                    "type": "waitForLoadState"
                },
                {
                    "type": "scrapeSchema",
                    "args": {
                        "id": ".parameter--info :text(\"ID inzerátu\") strong",
                        "title": "h1",
                        "date": ".date",
                        "price": ".price--main.paramNo0",
                        "offerType": ".parameter--info :text(\"Typ\") strong",
                        "type": ".parameter--info :text(\"Druh\") strong",
                        "condition": ".parameter--info :text(\"Stav\") strong",
                        "roomNo": ".additional-features--item :text(\"izieb\") strong:visible",
                        "floorNo": ".additional-features--item :text(\"podlaží\") strong:visible",
                        "utilityArea": ".parameter--info :text(\"Úžit. plocha\") strong",
                        "builtArea": ".parameter--info :text(\"Zast. plocha\") strong",
                        "landArea": ".parameter--info :text(\"Plocha pozemku\") strong",
                        "location": ".top--info-location",
                        "desc": ".text-inner",
                        "broker": ".broker-name",
                        "brokerAddress": ".info--address"
                    }
                },
                {
                    "type": "close"
                }
            ]
        },
        {
            "id": "openDetailsInNewTabs",
            "where": {
                "selectors": [
                    "li + li .component-pagination__arrow-color"
                ]
            },
            "what": [
                {
                    "type": "waitForLoadState"
                },
                {
                    "type": "enqueueLinks",
                    "args": "a.advertisement-item--content__title"
                },
                {
                    "type": "close"
                }
            ]
        },
        {
            "id": "scrape_basic",
            "where": {
                "selectors": [
                    "li + li .component-pagination__arrow-color"
                ]
            },
            "what": [
                {
                    "type": "waitForLoadState"
                },
                {
                    "type": "scrape"
                },
                {
                    "type": "click",
                    "args": "li + li .component-pagination__arrow-color"
                },
                {
                    "type": "waitForTimeout",
                    "args": 2000
                }
            ]
        },
        {
            "id": "base",
            "where": {},
            "what": [
                {
                    "type": "goto",
                    "args": {
                        "$param": "url"
                    }
                },
                {
                    "type": "waitForLoadState"
                },
                {
                    "type": "waitForTimeout",
                    "args": 1000
                },
                {
                    "type": "flag"
                }
            ]
        }
    ]
}